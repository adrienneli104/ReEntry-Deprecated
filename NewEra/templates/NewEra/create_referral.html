{% extends "NewEra/base.html" %}

{% block page_specific_styles %}
{% endblock %}

{% block title %}{% block navtitle %}
	Create Referral
{% endblock %}{% endblock %}

{% block content %}

    <div id="del-confirm" class="modal">
        <div class="container text-center">
            <h3 class="text-white">Are you sure you want to delete this resource?</h3>
            <p class="text-white">Note: If this is the last resource, it will redirect you out of this page!</p>
            <div class="clearfix">
                <button type="button" onclick="cancel()" class="btn btn-light">Cancel</button>
                <button type="button" onclick="confirmDelete()" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>


    <div class="container" style="padding-top: 5%; padding-bottom: 5%;">
        <div class="row">
        <h4 class="text-left"><b>Let's finish the referral:</b></h4>
        </div>
        <br /><br />

        <div class="text-left">

            <h4>Referrals</h4>
            <p style="font-size: 1.15em">First, verify that the correct referrals have been selected:</p>
            <br />
            {% for r in resources %}
                <div class="row">
                    <div class="col">
                    <div id="resource-{{r.id}}" class="card resource-card border-0 shadow"> 
                        <div class="card-body">
                            <h5 class="card-title">{{r.name}}</h5>
                            <p class="card-text">{{r.description|truncatewords:35}}</p>
                            <a href="{{r.url}}" class="read-link">{{r.url}}</a>
                            <br><br>
                            <a id="{{r.id}}-del" href="#!" class="delete-link" onclick="deleteResource({{r.id}})"><b>Delete</b></a>
                        </div>  
                    </div>
                    </div>
                </div>
                <input type="hidden" name="resources[]" value="{{ r.id }}">
                <br />
            {% endfor %}

            <h4>Recipient Info</h4>
            <p style="font-size: 1.15em;">We just need a few more details about the recipient.</p>

            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-caseload-tab" data-toggle="tab" href="#nav-caseload" role="tab" aria-controls="nav-caseload" aria-selected="true">Select From Caseload</a>
                    <a class="nav-item nav-link" id="nav-new-tab" data-toggle="tab" href="#nav-new" role="tab" aria-controls="nav-new" aria-selected="false">Create an Out of System Referral</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-caseload" role="tabpanel" aria-labelledby="nav-caseload-tab">
                    <br/>
                    {% if recipients.count > 0 %}
                        <form action="{% url 'Create Referral' %}" method="POST">
                            {% for r in resources %}
                                <input type="hidden" name="resources[]" value="{{ r.id }}">
                            {% endfor %}

                            <label><b class="inline-label">Select User:</b>
                                <select name="user_id">
                                    {% for r in recipients %}
                                    <option value="{{ r.id }}">{{ r.first_name|add:' '|add:r.last_name }}</option>
                                    {% endfor %}
                                </select>
                            </label><br>

                            <label>
                                <b class="inline-label">Select Carrier:</b>
                                <select name="carrier">
                                    {% for c in carriers %}
                                    <option value="{{ c }}">{{ c }}</option>
                                    {% endfor %}
                                </select>
                            </label><br>

                            <label><b>Add Notes:</b></label><br>
                            <textarea type="text" name="notes" class="form-input" placeholder=" Add a notification note..."></textarea><br><br>

                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    {% else %}
                        {% if perms.resource.edit_resource %}
                            <em><p style="margin: auto;">There are currently no case load users.</p></em>
                        {% else %}
                            <em><p style="margin: auto;">There is no one currently on your case load.</p></em>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="tab-pane fade" id="nav-new" role="tabpanel" aria-labelledby="nav-new-tab">
                    <br/>
                    <form action="{% url 'Create Referral' %}" method="POST">
                        {% for r in resources %}
                            <input type="hidden" name="resources[]" value="{{ r.id }}">
                        {% endfor %}
                        
                        <label><b>Phone:</b></label>
                        <input type="tel" name="phone" placeholder="3152965004" class="form-input" minlength="10" maxlength="10" pattern="[0-9]{10}" required><br>

                        <label>
                            <b class="inline-label">Select Carrier:</b>
                            <select name="carrier">
                                {% for c in carriers %}
                                <option value="{{ c }}">{{ c }}</option>
                                {% endfor %}
                            </select>
                        </label><br>

                        <label><b>Email:&nbsp;&nbsp;</b></label>
                        <input type="email" name="email" placeholder="email@gmail.com" class="form-input" required><br>

                        <label><b>Add Notes:</b></label><br>
                        <textarea type="text" name="notes" class="form-input" placeholder=" Add a notification note..."></textarea><br><br>

                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>

        </div>
    </div>

{% endblock %}
{% block page_specific_scripts %}
{% if user.is_staff %}{%load static %}
<script src="{% static 'NewEra/referrals.js' %}" type="text/javascript"></script>
{% endif %}

{% endblock %}